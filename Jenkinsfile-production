node {
    def imageName = "tvphuong/dashboard-webapp-production"

    stage("Checkout SCM") {
        checkout scm
    }

    stage("Build Image") {
        sh "docker build -t ${imageName}:${env.BUILD_NUMBER} ."  // Build image using docker command
    }

    stage("Push Image") {
        docker.withRegistry("https://index.docker.io/v1/", "bongao-hub-credentials") {
            image.push()
        }
    }

    stage('Cleaning up') {
        sh "docker rmi $imageName:$env.BUILD_NUMBER"
    }
}